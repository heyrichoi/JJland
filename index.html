<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>JJ랜드 룰렛</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    padding: 24px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
    background: #000 url('https://github.com/heyrichoi/JJland/raw/main/%EC%A0%9C%EB%AA%A9%20%EC%97%86%EC%9D%8C-1.png') center/cover no-repeat fixed;
    color: #fef3c7;
    display: flex;
    justify-content: center;
  }
  .app {
    max-width: 1200px;
    width: min(1200px, 100%);
    background: radial-gradient(circle at top left, rgba(15,23,42,0.98), rgba(15,23,35,0.99));
    border-radius: 24px;
    padding: 20px 22px 26px;
    box-shadow: 0 0 40px rgba(15,23,42,0.9), 0 28px 80px rgba(0,0,0,0.95);
    border: 1px solid rgba(248,181,71,0.65);
  }
  .app-header {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px 4px 18px;
    border-bottom: 1px solid rgba(31,41,55,0.9);
    margin-bottom: 10px;
  }
  .title-section {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }
  .title-logo-wrap {
    width: 150px;
    height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .title-logo {
    width: 100%;
    height: auto;
    object-fit: contain;
  }
  .app-main {
    display: grid;
    grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
    gap: 18px;
  }
  .controls-shell {
    padding: 14px 14px 12px;
    border-radius: 16px;
    background: radial-gradient(circle at top left, rgba(15,23,42,0.96), rgba(21,24,33,0.98));
    box-shadow: inset 0 0 0 1px rgba(31,41,55,0.9);
  }
  .controls-group {
    margin-bottom: 18px;
  }
  .section-title {
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #9ca3af;
    margin-bottom: 4px;
  }
  label {
    display: block;
    font-size: 0.8rem;
    color: #e5e7eb;
    margin-bottom: 4px;
  }
  select, input[type="number"], input[type="text"] {
    background: #020617;
    border-radius: 9px;
    border: 1px solid rgba(55,65,81,0.9);
    color: #e5e7eb;
    padding: 7px 9px;
    font-size: 0.85rem;
    outline: none;
    width: 100%;
  }
  select:focus, input:focus {
    border-color: rgba(248,181,71,0.9);
    box-shadow: 0 0 0 1px rgba(248,181,71,0.7);
  }
  .row {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .items-editor {
    margin-top: 10px;
    max-height: 220px;
    overflow: auto;
    padding-right: 4px;
  }
  .item-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
  }
  .item-badge {
    min-width: 26px;
    height: 26px;
    border-radius: 999px;
    background: radial-gradient(circle at 30% 30%, #fed7aa, #fb923c);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.78rem;
    font-weight: 700;
    color: #111827;
    box-shadow: 0 0 10px rgba(248,181,71,0.7);
  }
  .item-remove {
    width: 22px;
    height: 22px;
    border-radius: 999px;
    border: none;
    background: transparent;
    color: #9ca3af;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: color 0.15s ease, background 0.15s ease, transform 0.15s ease;
  }
  .item-remove:hover {
    color: #fecaca;
    background: rgba(239,68,68,0.2);
    transform: translateY(-1px);
  }
  .btn-primary, .btn-secondary {
    border-radius: 999px;
    border: none;
    cursor: pointer;
    padding: 8px 16px;
    font-size: 0.86rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
    white-space: nowrap;
  }
  .btn-primary {
    background: radial-gradient(circle at 20% 0%, #fb923c, #f97316 35%, #facc15 100%);
    color: #111827;
    box-shadow: 0 12px 30px rgba(248,153,29,0.7);
  }
  .btn-primary:hover {
    transform: translateY(-1px) scale(1.01);
    box-shadow: 0 16px 40px rgba(248,153,29,0.9);
  }
  .btn-secondary {
    background: rgba(15,23,42,0.96);
    color: #e5e7eb;
    border: 1px solid rgba(75,85,99,0.9);
  }
  .btn-secondary:hover {
    background: rgba(30,64,175,0.4);
    border-color: rgba(129,140,248,0.9);
  }
  .btn-chip {
    padding-inline: 10px;
    font-size: 0.78rem;
  }
  .checkbox-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
    font-size: 0.8rem;
  }
  .checkbox-row input[type="checkbox"] {
    width: 14px;
    height: 14px;
  }
  .current-options {
    margin-top: 10px;
    font-size: 0.78rem;
  }
  .current-options span {
    display: inline-block;
    background: rgba(248,181,71,0.18);
    padding: 3px 8px;
    border-radius: 999px;
    margin: 0 4px 4px 0;
    border: 1px solid rgba(254,243,199,0.7);
  }
  .hint {
    font-size: 0.72rem;
    color: #9ca3af;
    margin-top: 4px;
  }
  .roulette-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 18px;
    padding: 16px 10px 10px;
    background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
    border-radius: 18px;
    box-shadow: inset 0 0 0 1px rgba(31,41,55,0.9);
  }
  .roulette-title {
    font-size: 0.9rem;
    font-weight: 600;
  }
  .roulette-subtitle {
    font-size: 0.78rem;
    color: #9ca3af;
  }
  .wheel-container {
    position: relative;
    width: 360px;
    height: 360px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .wheel-ring {
    position: absolute;
    inset: 12px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 20%, rgba(148,163,184,0.25), rgba(15,23,42,1));
    box-shadow: 0 18px 45px rgba(0,0,0,0.85);
  }
  .wheel-shell {
    position: absolute;
    inset: 40px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 20%, rgba(15,23,42,0.9), #020617);
  }
  .wheel {
    position: relative;
    width: 82%;
    height: 82%;
    border-radius: 50%;
    border: 6px solid rgba(15,23,42,0.95);
    box-shadow: 0 0 0 3px rgba(15,23,42,0.9), 0 10px 24px rgba(15,23,42,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    transform: rotate(0deg);
  }
  .wheel-center {
    position: absolute;
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #111827, #020617 70%, #000 100%);
    box-shadow: 0 0 0 4px rgba(15,23,42,0.95), 0 0 26px rgba(15,23,42,0.9);
    z-index: 3;
  }
  .pointer {
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 52px;
    height: 52px;
    z-index: 5;
    pointer-events: none;
    filter: drop-shadow(0 0 10px rgba(250,204,21,0.9));
  }
  .wheel-labels {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }
  .slice-label {
    position: absolute;
    left: 50%;
    top: 50%;
    transform-origin: 50% 50%;
  }
  .slice-label span {
    position: absolute;
    left: 50%;
    top: 50%;
    transform-origin: 50% 50%;
    min-width: 0;
    max-width: 80px;
    font-size: 0.72rem;
    font-weight: 600;
    color: #111827;
    text-align: center;
    word-break: keep-all;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    text-shadow: 0 0 3px rgba(255,255,255,0.9);
  }
  .result-box {
    text-align: center;
    margin-top: 4px;
  }
  .result-title {
    font-size: 0.8rem;
    color: #9ca3af;
    margin-bottom: 4px;
  }
  .result-value {
    min-height: 24px;
    font-size: 1rem;
    font-weight: 600;
  }

  @media (max-width: 880px) {
    body { padding: 16px; }
    .app-main { grid-template-columns: minmax(0,1fr); }
    .wheel-container { width: 300px; height: 300px; }
  }
  @media (max-width: 640px) {
    body { padding: 10px; }
    .app { border-radius: 18px; padding: 14px 14px 18px; }
    .wheel-container { width: 260px; height: 260px; }
  }
</style>
</head>
<body>
<div class="app">
  <!-- 헤더 -->
  <header class="app-header">
    <div class="title-section">
      <div class="title-logo-wrap">
        <img class="title-logo" src="https://github.com/heyrichoi/JJland/blob/main/daa52e8b-e892-4fea-9bb3-1d5888167c6b.png?raw=true" />
      </div>
    </div>
  </header>

  <!-- 메인 -->
  <main class="app-main">

    <!-- 왼쪽 컨트롤 패널 -->
    <section class="controls-shell">
      <!-- 프리셋 선택 -->
      <div class="controls-group">
        <div class="section-title">PRESET</div>
        <label>프리셋 선택</label>
        <select id="presetSelect"></select>
      </div>

      <!-- 항목 편집 -->
      <div class="controls-group">
        <div class="section-title">ITEMS</div>
        <label>항목 개수</label>
        <div class="row">
          <input type="number" id="itemCount" min="1" max="20" />
          <button class="btn-secondary" id="presetInit">프리셋 초기화</button>
        </div>

        <div class="items-editor" id="itemsEditor"></div>

        <div class="checkbox-row" id="removeRow">
          <input type="checkbox" id="removeOnWin" />
          <label for="removeOnWin">당첨된 캐릭터 제거</label>
          <button class="btn-secondary btn-chip" id="restorePrev">직전 캐릭터 다시 추가</button>
        </div>

        <div class="current-options" id="currentOptions"></div>
      </div>

      <!-- 환불 배수 룰렛 -->
      <div class="controls-group" id="refundGroup">
        <div class="section-title">환불 배수 룰렛</div>
        <div class="row">
          <label>받은 버스비</label>
          <input type="number" id="refundBase" />
        </div>
        <div class="row" style="margin-top:6px; flex-wrap:wrap;">
          <button class="btn-secondary btn-chip refund-btn" data-x="1">1배</button>
          <button class="btn-secondary btn-chip refund-btn" data-x="1.5">1.5배</button>
          <button class="btn-secondary btn-chip refund-btn" data-x="2">2배</button>
          <button class="btn-secondary btn-chip refund-btn" data-x="2.5">2.5배</button>
          <button class="btn-secondary btn-chip refund-btn" data-x="3">3배</button>
        </div>
        <p class="hint">배수를 추가하면 환불 배수 전용 룰렛으로 전환되며, 당첨 시 버스비 × 배수 금액을 계산해 줍니다.</p>
      </div>

      <!-- 대신 환불 룰렛 전용 설정 -->
      <div class="controls-group" id="busGroup" style="display:none;">
        <div class="section-title">대신 환불 룰렛</div>
        <label for="busCountSelect">버스 인원수 선택</label>
        <div class="row">
          <select id="busCountSelect">
            <option value="2">2인</option>
            <option value="3">3인</option>
            <option value="4">4인</option>
            <option value="5">5인</option>
            <option value="6">6인</option>
          </select>
          <button class="btn-secondary btn-chip" id="applyBusPreset">인원수 적용</button>
        </div>
        <p class="hint">선택한 인원수만큼 1번, 2번, 3번... 항목이 자동으로 생성됩니다.</p>
      </div>

    </section>

    <!-- 오른쪽 룰렛 -->
    <section class="roulette-wrapper">
      <div class="roulette-header">
        <div>
          <div class="roulette-title">룰렛 미리보기</div>
          <div class="roulette-subtitle">옵션을 수정하면 룰렛에 바로 반영됩니다.</div>
        </div>
      </div>

      <div class="wheel-container">
        <div class="wheel-ring"></div>
        <div class="wheel-shell"></div>
        <div class="wheel" id="wheel"></div>
        <div class="wheel-labels" id="wheelLabels"></div>
        <div class="wheel-center" id="wheelCenter"></div>
        <img class="pointer" id="pointer" src="https://github.com/heyrichoi/JJland/blob/main/ChatGPT%20Image%202025%EB%85%84%2011%EC%9B%94%2015%EC%9D%BC%20%EC%98%A4%EC%A0%84%2001_30_28.png?raw=true" alt="" />
      </div>

      <div class="result-box">
        <div class="result-title">이번 결과</div>
        <div class="result-value" id="resultValue"></div>
      </div>

      <button class="btn-primary" id="spinBtn">🎡 JJ랜드 룰렛 돌리기</button>
    </section>

  </main>
</div>

<script>
(function() {
  // DOM 요소 캐시
  const presetSelect = document.getElementById('presetSelect');
  const itemCountInput = document.getElementById('itemCount');
  const itemsEditor = document.getElementById('itemsEditor');
  const removeOnWinCheckbox = document.getElementById('removeOnWin');
  const removeRow = document.getElementById('removeRow');
  const restorePrevBtn = document.getElementById('restorePrev');
  const currentOptionsEl = document.getElementById('currentOptions');
  const presetInitBtn = document.getElementById('presetInit');
  const refundBaseInput = document.getElementById('refundBase');
  const refundButtons = document.querySelectorAll('.refund-btn');
  const busGroup = document.getElementById('busGroup');
  const refundGroup = document.getElementById('refundGroup');
  const busCountSelect = document.getElementById('busCountSelect');
  const applyBusPresetBtn = document.getElementById('applyBusPreset');

  const wheel = document.getElementById('wheel');
  const wheelLabels = document.getElementById('wheelLabels');
  const spinBtn = document.getElementById('spinBtn');
  const resultValue = document.getElementById('resultValue');

  // 색상 팔레트
  const colors = ['#f97316', '#38bdf8', '#a855f7', '#22c55e', '#ec4899', '#4f46e5', '#facc15', '#14b8a6'];

  // 프리셋 정의
  const presets = [
    {
      id: 'chars_all',
      label: '캐릭터 룰렛 - 전체 캐릭터',
      type: 'normal',
      items: ['쫀지','착해진쫀지','쫀빈후드','쫀지퍼','비비탄쫀','쫀두광','쫀다르크','노키즈쫀','무쫀도사']
    },
    {
      id: 'chars_top6',
      label: '캐릭터 룰렛 - TOP 6',
      type: 'normal',
      items: ['쫀지','착해진쫀지','쫀빈후드','쫀지퍼','비비탄쫀','쫀두광']
    },
    {
      id: 'tries',
      label: '트라이 횟수 룰렛 - 트라이 횟수',
      type: 'normal',
      items: ['1트','2트','3트']
    },
    {
      id: 'deca',
      label: '데카 룰렛 - 데카 사용 여부',
      type: 'normal',
      items: ['데카 사용 가능','데카 사용 불가능']
    },
    {
      id: 'refund',
      label: '환불 배수 룰렛',
      type: 'refund',
      items: ['1배','1.5배','2배','2.5배','3배']
    },
    {
      id: 'bus',
      label: '대신 환불 룰렛',
      type: 'bus',
      items: []
    },
    {
      id: 'custom',
      label: '커스텀 룰렛',
      type: 'normal',
      items: []
    }
  ];

  const multiplierMap = {
    '1배': 1,
    '1.5배': 1.5,
    '2배': 2,
    '2.5배': 2.5,
    '3배': 3
  };

  let items = [];
  let currentPreset = presets[0];
  let mode = 'normal'; // 'normal' | 'refundMultiplier'
  let lastRemoved = null;
  let isSpinning = false;
  let currentRotation = 0;

  // 프리셋 셀렉트 초기화
  function initPresetSelect() {
    presets.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.textContent = p.label;
      presetSelect.appendChild(opt);
    });
    presetSelect.value = currentPreset.id;
  }

  // 프리셋 적용
  function setPreset(preset) {
    currentPreset = preset;
    mode = preset.type === 'refund' ? 'refundMultiplier' : 'normal';

    // 보조 패널 기본 숨김
    busGroup.style.display = 'none';
    refundGroup.style.display = 'none';

    // 캐릭터 룰렛에서만 \"당첨된 캐릭터 제거\" 사용
    if (preset.id === 'chars_all' || preset.id === 'chars_top6') {
      removeRow.style.display = 'flex';
    } else {
      removeRow.style.display = 'none';
      removeOnWinCheckbox.checked = false;
      lastRemoved = null;
    }

    if (preset.type === 'bus') {
      busGroup.style.display = 'block';
      applyBusPreset();
    } else if (preset.type === 'refund') {
      refundGroup.style.display = 'block';
      items = preset.items.slice();
      updateAll();
    } else {
      items = preset.items.slice();
      updateAll();
    }
  }

  // 대신 환불: 버스 인원수에 맞게 1번~N번 생성
  function applyBusPreset() {
    const n = parseInt(busCountSelect.value, 10) || 2;
    items = Array.from({ length: n }, (_, i) => `${i + 1}번`);
    updateAll();
  }

  function updateItemCountFromState() {
    itemCountInput.value = items.length;
  }

  // 항목 편집 UI 렌더링
  function renderItemsEditor() {
    itemsEditor.innerHTML = '';
    items.forEach((text, idx) => {
      const row = document.createElement('div');
      row.className = 'item-row';

      const badge = document.createElement('div');
      badge.className = 'item-badge';
      badge.textContent = idx + 1;

      const input = document.createElement('input');
      input.type = 'text';
      input.value = text;
      input.addEventListener('input', () => {
        items[idx] = input.value.trim();
        renderWheel();
        renderCurrentOptions();
      });

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'item-remove';
      removeBtn.textContent = '✕';
      removeBtn.addEventListener('click', () => {
        items.splice(idx, 1);
        updateAll();
      });

      row.appendChild(badge);
      row.appendChild(input);
      row.appendChild(removeBtn);
      itemsEditor.appendChild(row);
    });
  }

  // 현재 옵션 칩 렌더링
  function renderCurrentOptions() {
    currentOptionsEl.innerHTML = '';
    if (!items.length) return;
    items.forEach((t, idx) => {
      const span = document.createElement('span');
      span.textContent = `${idx + 1}. ${t || '(빈 항목)'}`;
      currentOptionsEl.appendChild(span);
    });
  }

  // 룰렛 그리기
  function renderWheel() {
    const activeItems = items.filter(t => t.trim() !== '');
    const n = activeItems.length;
    const step = n ? 360 / n : 0;

    if (!n) {
      wheel.style.background = 'radial-gradient(circle at 30% 20%, #020617, #020617)';
      wheelLabels.innerHTML = '';
      return;
    }

    const parts = [];
    for (let i = 0; i < n; i++) {
      const start = i * step;
      const end = (i + 1) * step;
      const color = colors[i % colors.length];
      parts.push(`${color} ${start}deg ${end}deg`);
    }
    wheel.style.background = `conic-gradient(${parts.join(',')})`;

    // 라벨
    wheelLabels.innerHTML = '';
    const radius = wheel.offsetWidth / 2;
    const textRadius = radius - 30;

    activeItems.forEach((text, i) => {
      const label = document.createElement('div');
      label.className = 'slice-label';
      const span = document.createElement('span');
      span.textContent = text;
      label.appendChild(span);

      const angle = -90 + step * i + step / 2;
      const rad = angle * Math.PI / 180;
      const x = Math.cos(rad) * textRadius;
      const y = Math.sin(rad) * textRadius;

      label.style.left = '50%';
      label.style.top = '50%';
      label.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px) rotate(${angle}deg)`;
      span.style.transform = 'translate(-50%, -50%)';

      wheelLabels.appendChild(label);
    });
  }

  function updateAll() {
    updateItemCountFromState();
    renderItemsEditor();
    renderCurrentOptions();
    renderWheel();
  }

  // 당첨 처리
  function handleWin(winnerIndex) {
    const activeItems = items.filter(t => t.trim() !== '');
    if (!activeItems.length) return;

    const winnerText = activeItems[winnerIndex];
    if (!winnerText) return;

    if (mode === 'refundMultiplier') {
      const base = parseFloat(refundBaseInput.value || '0');
      const m = multiplierMap[winnerText];
      if (base > 0 && m) {
        const amount = Math.round(base * m);
        resultValue.textContent = `${winnerText} 당첨! → 약 ${amount.toLocaleString()}원`;
      } else {
        resultValue.textContent = `${winnerText} 당첨!`;
      }
    } else {
      resultValue.textContent = `${winnerText} 당첨!`;
    }

    if (removeOnWinCheckbox.checked && (currentPreset.id === 'chars_all' || currentPreset.id === 'chars_top6')) {
      let count = -1;
      for (let i = 0; i < items.length; i++) {
        if (items[i].trim() === '') continue;
        count++;
        if (count === winnerIndex) {
          lastRemoved = items[i];
          items.splice(i, 1);
          updateAll();
          break;
        }
      }
    }
  }

  // 룰렛 스핀
  function spin() {
    const activeItems = items.filter(t => t.trim() !== '');
    const n = activeItems.length;
    if (isSpinning || !n) return;

    isSpinning = true;
    const step = 360 / n;
    const winnerIndex = Math.floor(Math.random() * n);
    const angle = -90 + step * winnerIndex + step / 2;
    const targetAngle = -90;

    let phi = (angle + currentRotation - targetAngle) % 360;
    if (phi < 0) phi += 360;
    const extraSpins = 4 + Math.floor(Math.random() * 3);
    const delta = (360 - phi) + 360 * extraSpins;
    const finalRotation = currentRotation + delta;

    wheel.style.transition = 'transform 4s cubic-bezier(0.19, 1, 0.22, 1)';
    wheelLabels.style.transition = 'transform 4s cubic-bezier(0.19, 1, 0.22, 1)';

    requestAnimationFrame(() => {
      wheel.style.transform = `rotate(${finalRotation}deg)`;
      wheelLabels.style.transform = `rotate(${finalRotation}deg)`;
    });

    setTimeout(() => {
      currentRotation = finalRotation;
      isSpinning = false;
      handleWin(winnerIndex);
    }, 4100);
  }

  // 이벤트 바인딩
  presetSelect.addEventListener('change', () => {
    const id = presetSelect.value;
    const preset = presets.find(p => p.id === id) || presets[0];
    setPreset(preset);
  });

  presetInitBtn.addEventListener('click', () => {
    if (currentPreset) setPreset(currentPreset);
  });

  itemCountInput.addEventListener('change', () => {
    let n = parseInt(itemCountInput.value, 10) || 1;
    n = Math.max(1, Math.min(20, n));
    const diff = n - items.length;
    if (diff > 0) {
      for (let i = 0; i < diff; i++) items.push('');
    } else if (diff < 0) {
      items.length = n;
    }
    updateAll();
  });

  restorePrevBtn.addEventListener('click', () => {
    if (!lastRemoved) return;
    items.push(lastRemoved);
    lastRemoved = null;
    updateAll();
  });

  refundButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const refundPreset = presets.find(p => p.id === 'refund');
      if (refundPreset && currentPreset.id !== 'refund') {
        presetSelect.value = 'refund';
        setPreset(refundPreset);
      }
      mode = 'refundMultiplier';
      const label = `${btn.dataset.x}배`;
      if (!items.includes(label)) {
        items.push(label);
      }
      updateAll();
    });
  });

  applyBusPresetBtn.addEventListener('click', () => {
    applyBusPreset();
  });

  spinBtn.addEventListener('click', spin);

  // 초기화
  initPresetSelect();
  setPreset(currentPreset);
})();
</script>
</body>
</html>
